<!DOCTYPE html>
<html>
<head>
    <title>Atlanta Vegan Restaurant Guide</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" href="css/main.css" />
    <script src="js/mustache.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/data.js"></script>
</head>
<body>
    <div id="column" class="template">
        <div class="span3">
            <div class="row-fluid">
                <h2>{{category}}</h2>
            </div> <!-- /.row-fluid -->
            {{#places}}
            <div class="place row-fluid">
                <span class="name">{{#link}}<a href="{{link}}" target="_blank">{{/link}}{{name}}{{#link}}</a>{{/link}}</span>
                <span class="price">{{price}}</span>
                <p class="address">
                    {{address}}
                    {{^map_override}}
                    <a href="https://maps.google.com/maps?q={{map}}" target="_blank" >
                        <i class="icon-map-marker"></i>
                    </a>
                    {{/map_override}}
                </p>
                <p class="notes"> {{{notes}}} </p>
            </div> <!-- /.row-fluid -->
            {{/places}}
        </div> <!-- /.span3 -->
    </div> <!-- /#column.template -->
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="#">Atlanta Vegan Restaurant Guide</a>
                <div class="nav-collapse">
                    <ul class="nav">
                        <li><a data-toggle="modal" href="#suggest">Suggest <i class="icon-comment icon-white"></i></a></li>
                        <li><a data-toggle="modal" href="#donate">Donate <i class="icon-gift icon-white"></i></a></li>
                        <li>
                            <form class="navbar-search">
                                <input type="text" id="filter" class="search-query" placeholder="Search">
                            </form>
                        </li>
                    </ul> <!-- /.nav -->
                    <span class="brand">Brought to you by <a href="http://cracktheplates.com"> Crack the Plates</a>!</span>
                </div> <!-- /.nav-collapse -->
            </div> <!-- /.container -->
        </div> <!-- /.navbar-inner -->
    </div> <!-- /.navbar -->
    <div id="content" class="container-fluid">
        <div class="row-fluid">
            <!-- render each column template here -->
        </div> <!-- /.row-fluid -->
    </div> <!-- /.container-fluid -->
    <hr>
    <footer>
        All location data &#169;  <a href="http://cracktheplates.com">crack the plates</a>. website code is <a href="http://github.com/nathanielksmith/vegguide">open source</a> and written by <a href="http://chiptheglasses.com">chip the glasses</a>.
    </footer>
    <div class="modal fade hide" id="suggest">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><i class="icon-remove"></i></button>
            <h3>Suggest a place!</h3>
        </div> <!-- /.modal-header -->
        <div class="modal-body">
            <p>This guide wouldn't exist without an awesome vegan community
            brainstorming on what should be here. Is a favorite place of yours
            missing? Let us know! A human will approve it and add it to the
            site in a few days.</p>
            <form class="well">
                <label class="control-label">I'd like to suggest a</label>
                <div class="controls">
                    <label class="radio">
                        <input type="radio" name="type" value="restaurant" checked="true" />
                        restaurant
                    </label>
                    <label class="radio">
                        <input type="radio" name="type" value="grocery" />
                        grocery
                    </label>
                </div> <!-- /.controls -->
                <label class="control-label">that's</label>
                <div class="controls">
                    <label class="radio">
                        <input type="radio" name="vegliness" value="vegan" checked="true" />
                        vegan.
                    </label>
                    <label class="radio">
                        <input type="radio" name="vegliness" value="vegetarian" />
                        vegetarian.
                    </label>
                    <label class="radio">
                        <input type="radio" name="vegliness" value="friendly" />
                        vegan Friendly.
                    </label>
                </div> <!-- /.controls -->
                <div class="control-group">
                    <label class="control-label" for="name">Name</label>
                    <div class="controls">
                        <input class="span2" id="name" name="name" type="text" placeholder="" />
                    </div> <!-- /.controls -->
                </div> <!-- /.control-group -->
                <div class="control-group">
                    <label class="control-label" for="price">Price per person</label>
                    <div class="controls">
                        <label class="checkbox">
                            <input type="checkbox" name="price" value="$" />
                            under $10
                        </label>
                        <label class="checkbox">
                            <input type="checkbox" name="price" value="$$" />
                            $10 - $20
                        </label>
                        <label class="checkbox">
                            <input type="checkbox" name="price" value="$$$" />
                            $20 - $30
                        </label>
                        <label class="checkbox">
                            <input type="checkbox" name="price" value="$$$$" />
                            over $30
                        </label>
                    </div> <!-- /.controls -->
                </div> <!-- /.control-group -->
                <div class="control-group">
                    <label class="control-label" for="address">Street Adress</label>
                    <div class="controls">
                        <input class="span2" id="address" name="address" type="text" placeholder="555 foobar st." />
                    </div> <!-- /.controls -->
                </div> <!-- /.control-group -->
                <div class="control-group">
                    <label class="control-label" for="notes">Notes</label>
                    <div class="controls">
                        <input class="span2" id="notes" name="notes" type="text" placeholder="what sort of food, family-friendliness, etc" />
                    </div> <!-- /.controls -->
                </div> <!-- /.control-group -->
                <div class="control-group">
                    <label class="control-label" for="human">What's four times three?</label>
                    <div class="controls">
                        <input type="text" name="human" id="human" />
                    </div>
                </div> <!-- /.control-group -->
                <div style="text-align:right">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </form>
        </div> <!-- /.modal-body -->
    </div> <!-- /.modal -->
    <div class="modal fade" id="donate">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><i class="icon-remove"></i></button>
            <h3>Donate to the ATL Veg Guide</h3>
        </div> <!-- /.modal-header -->
        <div class="modal-body">
            <p>
                This guide is a volunteer effort and donations are gladly accepted. What will we use them for?
                <ul>
                    <li>Server costs at <a href="http://rackspace.com">Rackspace</a></li>
                    <li>Printing costs for the paper version</li>
                    <li>Marketing/Advertising costs</li>
                </ul>
            </p>
        </div> <!-- /.modal-body -->
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
        </div> <!-- /.modal-footer -->
    </div> <!-- /.modal -->
    <script>
        // add map function
        data.forEach(function(column) {
            column.places.forEach(function(p) {
                // gutenfleischers, mysore woodlands, graveyard, revolution, spoon west, we suki suki, arden's, tradjoe, wf
                p.map = function() {
                    return (this.name+' '+this.address).replace(/ /g, '+');
                };
            });
        });
        // lay out data
        var column_tmpl = $('#column.template').html();
        $('#content div.row-fluid').html(data.reduce(function(p, c) {
            return p + Mustache.render(column_tmpl, c);
        }, ""));

        // suggestion form
        $('#suggest form').submit(function(e) {
            e.preventDefault();
            $.post('http://localhost:3000/suggest', $("#suggest form").serialize())
            .success(function() {
                console.log('hooray');
                // hide suggest
                // pop up hooray modal
            })
            .error(function() {
                console.log('fail');
                // try again modal
            });
        });

        // filtering
        $('#filter').keyup(function() {
            var search = $('#filter').attr('value');
            console.log(search);
            if (search === '') {
                $('.place').show();
            }
            else {
                $('.place').each(function() {
                    var $place = $(this);
                    var selectors = ['.address', '.name', '.notes'];
                    var match = selectors.reduce(function(p,c) {
                        return p || Boolean($place.find(c).text().toLowerCase().match(search));
                    }, false);
                    if (!match) { $place.hide(); }
                    else { $place.show(); }
                });
            }
        });
    </script>
</body>
</html>
